<!doctype html>

<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'>
    <meta name='mobile-web-app-capable' content='yes'>
    <meta name='apple-mobile-web-app-capable' content='yes'>

    <title>glTF2 API Test</title>

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background-color: #000000;
      }

      canvas {
        position: absolute;
        z-index: 0;
        height: 100%;
        width: 100%;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: 0;
      }

      select {
        position: absolute;
        z-index: 1;
        top: 1em;
        right: 1em;
      }
    </style>
  </head>
  <body>
    <select id='api'>
      <option value=''>- Choose an API -</option>
      <option value='webgl'>WebGL</option>
      <option value='webgl2'>WebGL 2.0</option>
      <option value='webgpu'>WebGPU</option>
    </select>
    <script type="module">
      import Stats from './js/third-party/stats.module.js';

      import { Gltf2Loader } from './js/mini-gltf2.js';

      import { WebGLRenderer } from './js/webgl-renderer.js';
      import { WebGL2Renderer } from './js/webgl2-renderer.js';
      import { WebGPURenderer } from './js/webgpu-renderer.js';

      let renderer = null;
      let stats = new Stats();
      document.body.appendChild(stats.dom);

      const apiSelect = document.getElementById('api');
      apiSelect.addEventListener('change', async () => {
        if (renderer) {
          renderer.stop();
          document.body.removeChild(renderer.canvas);
        }

        switch(apiSelect.value) {
          case 'webgl':
            renderer = new WebGLRenderer();
            break;
          case 'webgl2':
            renderer = new WebGL2Renderer();
            break;
          case 'webgpu':
            renderer = new WebGPURenderer();
            break;
          default:
            renderer = null;
            break;
        }

        if (renderer) {
          await renderer.init();
          renderer.setStats(stats);
          document.body.appendChild(renderer.canvas);
          renderer.start();
        }
      });

      const gltfLoader = new Gltf2Loader();
      gltfLoader.loadFromUrl('./media/models/sponza/sponza.gltf').then((gltf) => {
        console.log('glTF:', gltf);
      });
    </script>
  </body>
</html>